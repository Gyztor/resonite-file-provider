x-common:
  database:
    &db-env
    # db-env needed to call vars later.
    MARIADB_DATABASE: resonite-inventory
    MARIADB_USER: resonite-inventory
    MARIADB_PASSWORD: resonitepassword
services:
  app:
    image: ghcr.io/spaceey1/resonite-file-provider:latest
    container_name: resonite-file-provider
    restart: always
    environment:
      <<: *db-env
      BEHIND_PROXY: false
      JWT_SECRET_KEY: "TestkeyPLSCHANGEME!!!!!"
      TZ: "UTC"
      HOST: "localhost" # CHANGE TO YOUR DOMAIN
      PORT: 5819 #set to what you want the server port to be externally
    ports:
      - "5819:5819"
    volumes:
      - ./live-data/assets:/app/assets
      - ./upload-site:/app/upload-site
#      - /etc/resonite-inventory/jwt.key:/run/secrets/jwt.key
    depends_on:
      - db
    networks:
      - resonite-network

  db:
    image: mariadb:lts
    container_name: resonite-db
    restart: always
    environment:
      <<: *db-env
      MARIADB_ROOT_PASSWORD: rootpassword
    volumes:
      - ./live-data/mysql-data:/var/lib/mysql
      - ./live-data/mysql-logs:/var/log/mysql
      - ./resonite-inventory-schema.sql:/docker-entrypoint-initdb.d/resonite-inventory-schema.sql
    ports:
      - "3306:3306"
    networks:
      - resonite-network

networks:
  resonite-network:
    driver: bridge
